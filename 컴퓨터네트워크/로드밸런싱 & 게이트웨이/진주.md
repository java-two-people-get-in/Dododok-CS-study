# 로드밸런싱 & 게이트웨이

## 로드밸런싱

![image](https://github.com/user-attachments/assets/574e0853-17ca-4d1f-a036-06f5ac36e8be)

### 로드 밸런싱이란?

부하분산 또는 로드 밸런싱은 컴퓨터 네트워크 기술의 일종으로 중앙처리장치 혹은 저장장치와 같은 컴퓨터 자원들에게 작업을 나누는 것을 의미한다.

서버에 가해지는 부하(=로드)를 분산(=밸런싱)해주는 장치 또는 기술이다.

사업의 규모가 확장되고, 클라이언트의 수가 늘어나게 되면 기존 서버만으로는 정상적인 서비스가 불가능하게 되는데, 이런 증가한 트래픽에 대처할 수 있는 방법은 크게 두 가지다.

- Scale up : 서버 자체의 성능을 높이는 것
- Scale out : 여러 대의 서버를 두는 것

Scale-out의 방식은 여러 대의 서버로 트래픽을 균등하게 분산해주는 로드밸런싱이 반드시 필요하다.

![image](https://github.com/user-attachments/assets/ace88d18-735e-4e5e-a8a0-1d393e863c62)

<br/>

### 로드 밸런싱 알고리즘

- 라운드로빈 방식(Roud Robin Method)
    - 서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식
    - 서버와의 연결이 오래 지속되지 않는 경우 적합하다.
- 가중 라운드로빈 방식 (Weighted Round Robin Method)
    - 각 서버에 가중치를 매기고 가중치가 높은 서버에 요청을 우선적으로 배정하는 방식
    - 서버의 트래픽 처리 능력이 다른 경우 사용한다.
- 최소 연결 방식 (Least Connection Method)
    - 요청이 들어온 시점에 가장 적은 연결 상태를 보이는 서버에 트래픽을 배정하는 방식.
    - 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합하다.
- IP 해시 방식 (IP Hash Time Method)
    - 클라이언트의 IP주소를 특정 서버로 매핑하여 요청을 처리하는 방식
    - 사용자가 항상 동일한 서버로 연결된다.

*부하 분산에는 L4 로드밸런서와 L7 로드밸런서가 가장 많이 활용된다. 그 이유는 L4 로드밸런서부터 포트(Port) 정보를 바탕으로 로드를 분산하는 것이 가능하기 때문. 한 대의 서버에 각기 다른 포트 번호를 부여하여 다수의 서버 프로그램을 운영하는 경우라면 최소 L4 로드밸런서 이상을 사용해야만 한다.

<br/>

### L4 로드 밸런싱

- 트랜스포트 계층에서 로드를 분산한다.
- TCP, UDP 포트 정보를 바탕으로 한다.
- 데이터 안을 보지 않고 패킷 레벨에서만 로드를 분산하기 때문에 속도가 빠르고 효율이 높음
- 섬세한 라우팅이 불가능하지만 L7로드 밸런서보다 저렴하다.

![image](https://github.com/user-attachments/assets/6281a883-66ce-4ef7-8a70-d08413a789ff)

<br/>

### L7 로드 밸런싱

- 애플리케이션 계층에서 로드를 분산한다.
- HTTP 헤더, 쿠키 등과 같은 사용자 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능하다. 즉, 패킷 내용을 확인하고 그 내용에 따라 로드를 특정 서버에 분배하는 것이 가능
    
    특정 기능을 하는 요청이 들어오면 그 요청을 처리하는 서버로 보내는,,,
    
- 더 섬세한 라우팅이 가능하고, 비정상적인 트래픽을 필터링 할 수 있다.
- 패킷의 내용을 복호화 해야하기 때문에 더 많은 비용이 든다.

![image](https://github.com/user-attachments/assets/fca39070-7681-4937-b37b-55a0baa73efa)

- L4 로드밸런서와 L7 로드밸런서 비교 분석 표

![image](https://github.com/user-attachments/assets/2753dbc5-e8fd-43b2-8e1f-36b28453c88b)

<br/><br/>

## 게이트웨이

### 게이트웨이란?

다른 네트워크로 나가거나 다른 네트워크게어 들어오도록 하기 위해 꼭 필요한 통신 기기 (로컬 호스트 중 하나)의 일부분이며, 통신 데이터가 다른 네트워크의 호스트와 통신하기 위해서 반드시 통과해야 하는 내부의 출입문이다.

<br/>

### 왜 필요한가?

동일한 네트워크에 있는 소수의 호스트 컴퓨터 간에 통신은 대상 간에 직접 통신을 하면 되기 때문에 통신 경로가 아주 단순하다. 그냥 서로 통신하면 된다.

![image](https://github.com/user-attachments/assets/790a4765-dbf8-4070-9749-68f2d0221b32)

그러나 서로 다른 네트워크에 있는 다수의 호스트 컴퓨터들이 서로 통신을 할 경우에는, 대상 간에 직접 통신을 하면 통신 경로가 아주 방대해지고 복잡해지기 때문에, 매우 비효율적이고 관리하기도 어렵다.

![image](https://github.com/user-attachments/assets/23b0ef8a-7fb0-4566-aebe-f6816004e011)

따라서 통신 경로를 단순화하고, 연결 회선을 효율적으로 관리하기 위해서 다수의 호스트들을 여러 그룹으로 나누고, 각 그룹의 호스트들은 한 지점에 공통적으로 접속하게 하며, 각 그룹의 공통된 지점을 다시 서로 연결하면, 다수 간의 통신 경로가 매우 단순화된다. 그리고 이때 각 그룹의 공통된 접속 지점이 바로 게이트웨이라 함!

![image](https://github.com/user-attachments/assets/a74ddf23-31e5-4d98-82ab-77850305c094)

→ 즉, 게이트웨이는 네트워크의 복잡한 연결을 단순화하고 효율적으로 관리하기 위해 반드시 필요한 기술!

- 만약 해당 네트워크의 외부에 있는 호스트 컴퓨터와 통신하지 않고 내부에 있는 호스트 컴퓨터들 간의 통신만 수행한다면 게이트워이는 불필요

![image](https://github.com/user-attachments/assets/1c79a8f3-721a-4c9c-bd5c-63bc95b7783f)

- 해당 네트워크의 외부에 있는 호스트 컴퓨터와 통신이 필요하다면 반드시 게이트웨이가 필요

![image](https://github.com/user-attachments/assets/9b0ed7b7-9d24-4d82-8fa2-c9867033c8b2)

<br/>

### 게이트웨이 의미와 주소

- 네트워크 : 주택
- 대문 : 게이트 웨이 → 게이트웨이 주소
- 각 방 : 호스트 컴퓨터 → IP 주소

![image](https://github.com/user-attachments/assets/057b0d1f-f9b8-44bb-bb82-a7f7f9ab4746)

- 게이트웨이 주소는 4개의 옥뎃 ([xxx.xxx.xxx.xxx](http://xxx.xxx.xxx.xxx/))로 구성되어 있으며, 호스트 컴퓨터의 IP 주소의 일종
- 즉 게이트웨이도 동일 네트워크에 있는 여러 호스트 컴퓨터들 중의 하나이며, 단지 외부로 나가거나 외부에서 들어오는 출입구 역할을 하는 특별한 장비의 일부분
    
    ex) 네트워크 대역이 192.168.0.0 ~ 192.168.0.255로 구성되어 있다면, 해당 대역의 IP 갯수는 256개.
    
    - 하지만 해당 네트워크의 제일 첫번째 주소인 '192.168.0.0'은 네트워크 주소이며, 제일 마지막 주소인 '192.168.0.255'는 브로드캐스트 주소이고, 이 두개의 주소는 호스트 컴퓨터에 할당할 수 없는 IP 주소이다.
    - 따라서 해당 대역에서 실제적으로 사용 가능한 IP 주소는 192.168.0.1 ~ 192.168.0.254로 254개이다.
    - 여기서 게이트웨이의 주소는 사용자가 254개의 주소 중에 임의로 선택하여 지정할 수 있다. 통상은 위의 2개의 주소(네트워크 주소, 브로드캐스트 주소)를 제외한 사용 가능한 주소(254개) 중에 첫번째 주소인 '192.168.0.1'로 지정하거나 또는 마지막 주소인 '192.168.0.254'로 지정한다.

<br/>

### 게이트웨이 === 라우터?

누군가는 라우터를 게이트웨이라고 하기도 하는데, **게이트웨이는 라우터가 아니다!** **라우터**는 패킷 데이터가 목적지까지 도달할 수 있도록 최적의 경로를 찾아서 안내하는 역할을 하며, **게이트웨이**는 다른 네트워크로 통하는 출입구 역할을 한다. 따라서 둘은 통신 과정에서 서로 완전히 다른 역할을 한다.
