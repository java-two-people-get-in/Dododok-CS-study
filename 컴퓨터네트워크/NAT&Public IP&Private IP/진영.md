# 공인 IP (Public IP)
인터넷 사용자의 로컬 네트워크를 식별하기 위해 ISP(인터넷 서비스 공급자)가 제공하는 IP 주소이다. 공용 IP 주소라고도 불리며 **외부에 공개되어 있는 IP 주소**이다.

공인 IP는 전세계에서 **유일한 IP 주소**를 갖는다.

공인 IP 주소가 외부에 공개되어 있기에 인터넷에 연결된 다른 PC로부터의 접근이 가능하다. 따라서 공인 IP 주소를 사용하는 경우에는 방화벽 등의 보안 프로그램을 설치할 필요가 있다.

# 사설 IP (Private IP)
일반 가정이나 회사 내 등에 할당된 네트워크의 IP 주소이며, 로컬 IP, 가상 IP라고도 한다. 서브넷팅된 IP이기 때문에 라우터에 의해 **로컬 네트워크상의 PC 나 장치에 할당**된다.

## 사설IP 주소대역
사설IP 주소는 다음 3가지 주소대역으로 고정된다.

**Class A** : 10.0.0.0 ~ 10.255.255.255
**Class B** : 172.16.0.0 ~ 172.31.255.255
**Class C** : 192.168.0.0 ~ 192.168.255.255


## 사설 IP와 공인 IP의 차이

![](https://velog.velcdn.com/images/ozziny/post/eadb27be-2dd3-424c-8049-03bb81ab7e9e/image.png)

> ❗ 사설 IP 주소만으로는 인터넷에 직접 연결할 수 없다. 라우터를 통해 1개의 공인(Public) IP만 할당하고, 라우터에 연결된 개인 PC는 사설(Private) IP를 각각 할당 받아 인터넷에 접속할 수 있게 된다.


# NAT이란?
> 네트워크 주소 변환(network address translation, 줄여서 NAT)은 컴퓨터 네트워킹에서 쓰이는 용어로서, IP패킷의 TCP/UDP 포트 숫자와 소스 및 목적지의 IP 주소 등을 재기록하면서 라우터를 통해 네트워크 트래픽을 주고 받는 기술을 말한다. 한 마디로 Network Address인 IP를 변환(Translation)하겠다는 뜻!

## NAT이 왜 필요할까?
바로 우리가 쓰는 공인 IP가 부족하기 때문이다!



그럼 왜 부족할까?

현재 우리는 ?.?.?.?형태의 IPv4형태의 주소를 사용하고 있는데
이는 8개의 연속적인 비트 집합을 의미하는 옥텟이 4개가 모여 이루어져 있는 구조이다.
즉, 2**^32=4,294,967,296 개로 약 43억 개의 공인 ip주소**가 있다고 생각하면 된다. 

따라서 카페에 있는 공유기에 연결된 모든 단말들은 **Private IP(사설 IP)를 보유**하게 된다. 그렇다면 인터넷을 사용할 때는 어떻게 되는 것일까?
**인터넷은 공인 IP로만 연결되어 통신이 가능**하다. 사설 IP를 Source Address로 유지한 채 인터넷으로 나아가는 것일까?



공인인터넷망과 제 컴퓨터 사이에는 내 컴퓨터에게 IP를 할당해주는 공유기가 있다. 그리고 공유기는 공인 IP를 보유하며 인터넷과 맞닿아있다.
**Private IP(172.30.1.36)뿐인 내 컴퓨터**가 **외부 서비스(8.8.8.8)을 사용**하고자 공유기로 나아가면, 공유기는 Private IP(172.30.1.36)뿐인 **내 컴퓨터의 IP를 공유기 자신의 공인 IP로 변환(Translation)** 하게 된다. 즉 공유기를 지나 외부 인터넷으로 나아갈 때에는 공유기의 **공인 IP를 가지고 원하는 Destination Address로 향하는 것**이다.
이것이 바로 NAT이라는 기술이다.


![](https://velog.velcdn.com/images/ozziny/post/a13dc43b-0d6a-4a61-8e83-1cb57ca9b1c5/image.png)

## NAT의 동작과정

1. 공유기에 연결된 컴퓨터들은 각각의 **사설 아이피를 부여**받는다.  예) 내 사설아이피 : 192.168.0.4
2. 만일 우리가 위키피디아라는 사이트에 접속하고 싶으면, 컴퓨터는 **게이트웨이 어드레스에 해당되는 IP 머신(공유기)에게 신호**를 보낸다.

![](https://velog.velcdn.com/images/ozziny/post/de660ae7-5193-4d0f-b36c-02851470a4ff/image.png)

3. 신호를 받은 공유기는 다음 순서에 따라 위키피디아에게 요청을 보낸다.
	3-1. 먼저 **요청받은 내부ip를 기록**한다. (192.168.0.4). 누가 요청했는지 알아야하니까.
	3-2. 요청한 컴퓨터 ip는 외부에서 접속할 수 없는 사설ip다. 따라서 **사설ip를 공인ip로 변환**한다.
    
![](https://velog.velcdn.com/images/ozziny/post/23add0c9-70de-43b9-a118-e4f9a0b39de1/image.png)

4. 이제, 공유기는 이 요청을 **public ip address 로 위키피디아에게 요청**을 하고 위키피디아는 그 요청을 처리한다. 
5. 그리고 다시 위키피디아에서 공인ip(59.6.66.238)로 보내고, **공유기에서 다시 사설ip로(192.168.0.4)로 보내서 통신을 완료**한다.

위와 같은 과정을 통해 private ip 를 사용하고 있는 컴퓨터가 사설 바깥쪽에 있는 public ip에 해당되는 외부세계에 접속할 수 있게 된다. 

이때 사용되는 기술이 바로 **NAT** 이라고 보면 된다.


## NAT 장점
![](https://velog.velcdn.com/images/ozziny/post/63ea51ac-bb99-45e7-b7d6-e14b1efe5464/image.png)

![](https://velog.velcdn.com/images/ozziny/post/15e33f93-87de-40d1-8aa8-4c3eaa5a679d/image.png)

좀 더 자세히 설명해보자면 아래 그림을 예로 들어보자

![](https://velog.velcdn.com/images/ozziny/post/d1e2c855-26e8-4ed2-a08b-d3f7b5899e83/image.png)


## NAT 단점
NAT가 호스트 간의 통신에 있어서 복잡성을 증가시킬 수 있으므로 네트워크 성능에 영향을 줄 수도 있다.


![](https://velog.velcdn.com/images/ozziny/post/6e29de2a-1090-44f6-85c3-80d63be3a9d0/image.png)
