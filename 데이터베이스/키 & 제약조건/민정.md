# [데이터베이스] 키&제약조건

![image](https://github.com/user-attachments/assets/9b9baae5-eb1b-48fb-9168-63db2ea96300)

## 유일성과 최소성
### 유일성
하나의 키값으로 튜플을 유일하게 식별할 수 있는 성질이다.

여러개의 튜플이 존재할 때 각각의 튜플을 서로 구분할 수 있어야 한다. 즉, 각각의 튜플을 유일해야 한다는 의미이다. 예를 들어 (주민번호, 나이, 사는곳, 혈액형)이라는 속성이 있을 때 나이, 사는곳, 혈액형은 중복될 수 있는 속성이다. 하지만 주민번호는 모두 다르기 때문에 각각의 튜플을 중복되는 속성 값이 존재할 수는 있지만 주민번호를 이용해 각 튜플을 구분할 수 있다. 이렇게 각각의 튜플을 구분할 수 있는 성질을 유일성이라고 합니다.

### 최소성
키를 구성하는 속성들 중 필요한 최소한의 속성들로만 키를 구성하는 성질이다.

쉽게 말해, 키를 구성하고 있는 속성들이 진짜 각 튜플을 구분하는 데 꼭 필요한 속성들로만 구성되어 있는지를 의미한다. 굳이 없어도 될 속성들을 넣지 말자는 의미이기도 하다. 예를 들어 (주민번호, 이름, 나이)가 키라면 각 튜플을 구분할 수 있다. 세가지가 모두 같은 사람은 없기 때문이다. 하지만 이름,나이가 없어도 주민번호만으로 가 튜플을 유일하게 식별할 수 있다. 이때 이름, 나이를 빼면 해당 키는 최소성을 만족한다.


## 키(Key)
릴레이션에서 특정 투플을 식별할 때 사용하는 속성 또는 속성의 집합을 의미한다.

키의 종류로는 슈퍼키(Super Key), 후보키(Candidate Key), 기본키(Primary Key), 대체키(Alternate Key), 외래키(Foreign Key)가 있다.

<img width="400" alt="스크린샷 2024-08-08 오후 8 10 40" src="https://github.com/user-attachments/assets/851b2cb4-2f4b-497b-aefb-cb090932f6ec">


### 1. 슈퍼키(Super Key) - 유일성 O, 최소성 X
투플을 유일하게 식별할 수 있는 하나의 속성 혹은 속성의 집합을 의미한다.
* 투플을 유일하게 식별할 수 있는 값이면 모두 슈퍼키가 될 수 있다.
* 학번, 주민등록번호 : 학생들을 구분할 수 있고 속성이 하나 뿐이므로 슈퍼키가 맞다.
* 성명, 성별 : 서로 같을 수 있기 때문에 슈퍼키가 아니다.

### 2. 후보키(Candidate Key) - 유일성 O, 최소성 O
투플을 유일하게 식별할 수 있는 속성의 최소 집합을 의미한다.
* 모든 릴레이션은 반드시 하나 이상의 후보키를 가져야한다.
* 후보키 중에서 기본키로 사용할 속성 집합을 선택할 수 있다.

Quiz)(주민번호,성명)은 후보키일까요?

Quiz)(학번,주민번호)은 후보키일까요? 

### 3. 기본키(Primary Key)
후보키들 중에서 하나를 메인으로 선택한 키를 의미한다.
* 릴레이션 내 투플을 식별할 수 있는 고유한 값을 가져야한다.
* NULL값을 허용하지 않는다.
* 키 값의 변동이 일어나지 않아야 한다.

### 4. 대체키(Alternate Key)
후보키가 둘 이상일 때 기본키를 제외한 나머지 후보키들을 의미한다.
* 위의 <학생>테이블에서 학번을 기본키로 정하면 주민번호가 대체키가 된다.

### 5. 외래키(Foreign Key)
다른 릴레이션의 기본키를 참조하는 속성을 의미한다.
* 릴레이션 간의 관계를 표현하는데 사용된다.
* 외래키로 지정되면 참조 테이블의 기본키에 없는 값은 입력할 수 없다. (참조 무결성 조건)
* 참조되는 값이 변경되면 참조하는 값도 변경된다.


<img width="450" alt="데이터베이스 키의 관계" src="https://github.com/user-attachments/assets/b4499a34-1d7e-4d61-9b0f-939ca1d11008">

## 데이터 무결성
데이터의 정확성, 일관성, 유효성이 유지되는 것을 의미한다.
* 정확성이란 중복이나 누락이 없는 상태,
* 일관성은 원인과 결과의 의미가 연속적으로 보장되어 변하지 않는 상태,
* 유효성은 사용자로 부터 값을 입력받을 때 정확한 값만 입력되도록 하는 것이다.

만약 데이터베이스에서 데이터 무결성 설계를 하지 않는다면 테이블에 중복된 데이터 존재, 부모와 자식 데이터 간의 논리적 관계 깨짐, 잦은 에러와 재개발 비용 발생 등과 같은 문제가 발생할 확률이 높아진다.

## 무결성 제약조건

데이터베이스의 무결성을 보장하기 위해 설정되는 조건으로, 데이터베이스의 상태를 일관되게 유지하고 데이터의 저장, 삭제, 수정 등을 제한하거나 조절하는 역할을 한다.

무결성 제약조건에는 “도메인 무결성 제약조건”, “개체 무결성 제약조건”, “참조 무결성 제약조건”이 있다.

### 도메인 무결성 제약조건 - 도메인 제약조건
도메인 무결성 제약 조건이란 각 속성의 값은 반드시 도메인에 지정된 값만을 가져야 한다는 조건이다.
* 속성 값과 관련된 무결성으로, SQL 문에서 데이터 형식(type), 널(null/not null), 기본값(default), 체크(check)등을 사용해 지정할 수 있다.
* CHECK 제약 조건 : 해당 컬럼에 입력할 수 있는 값의 범위나 조건 지정하는 것이다.
```
CREATE TABLE Customer (
    ID int NOT NULL,
    Age int,
    CHECK (Age>=18)
);
```

### 1. 개체 무결성 제약조건 - 기본키 제약조건
기본키는 NULL 값을 가져서는 안 되며(NOT NULL) 릴레이션 내에 오직 하나의 값만 존재해야 한다(UNIQUE)는 조건이다.

### 2. 참조 무결성 제약조건 - 외래키 제약조건
외래 키의 값은 Null이거나 참조 릴레이션의 기본키 값과 동일해야 하며, 자식 릴레이션의 값이 변경될 때 부모 릴레이션의 제약을 받는다는 조건이다.
즉 부모 릴레이션의 도메인과 다른 값으로 삽입, 수정될 경우 거부되고, 반대로 자식 릴레이션에사 참조하고 있는 값을 부모 릴레이션에서 삭제하거나 다른 값으로 변경하려고 하면 거부된다.

### 3. 참조 무결성 제약조건의 옵션
DBMS에서 부모 릴레이션에서 투플이 삭제할 때 참조 무결성 제약조건을 만족시키기 위한 옵션이다.

|명령어|의미|설명|
|------|---|---|
|RESTRICTED(제한)|자식 릴레이션에서 참조되고 있을 경우 부모 릴레이션의 삭제 작업을 거부함|학생 릴레이션의 투플 삭제 거부|
|CASCADE(연쇄)|자식 릴레이션의 관련 투플을 같이 삭제함|학생 릴레이션의 관련 투플을 삭제|
|DEFAULT|자식 릴레이션의 관련 투플을 미리 설정해둔 값으로 변경함|학생 릴레이션의 학과가 다른 학과로 자동 배정|
|NULL|자식 릴레이션의 관련 투플을 NULL 값으로 설정함|학생 릴레이션의 학과가 NULL 값으로 변경|

기본 삭제는 RESTRICTED가 디폴트이다.
