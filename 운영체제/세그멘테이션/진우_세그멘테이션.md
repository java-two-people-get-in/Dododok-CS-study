# [OS] 가상메모미 - 세그멘테이션 기법

Q. 32bit, 64bit 컴퓨터의 최대 메모리 크기?

A. 2^32 bit( 4GB), 2^64bit (1024PB)

Q. 메모리 계층 구조란?

A. 빠르고 비싼 저장공간을 CPU 근처에 두는 것

## 1. 메모리 분할

 프로세스를 메모리에 적재하기 위해 **적절하게 메모리를 분할**해야 한다.

**절대 주소, 물리 주소, 실제 주소**

메모리 관리자 입장에서. 실제 메모리에 존재하는 절대적인 주소(번지)를 말한다.

**상대 주소**

프로그램(프로세스) 내에서 사용하는 상대적인 주소이다. 프로세스 입장에서, 실제 메모리의 절대 위치를 알 필요가 없다. 항상 0번지부터 시작한다.

> **상대 주소를 절대 주소로 변환하는 방법**
상대주소 + 재배치레지스터 값 = 절대 주소
> 

### 1.1. 연속 메모리 분할

프로그램 전체를 하나의 큰 공간에 연속적으로 할당하는 방식.

**고정 분할 기법**(페이징 기법 in 가상메모리 전략)

메모리를 일정한 크기로 분할하는 방식이다. 
프로그램의 크기가 메모리 분할 사이즈보다 작은 경우, **내부 단편화**가 발생한다.

**가변 분할 기법(**세그멘테이션 기법 in 가상메모리 전략)

메모리를 동적으로 분할하여, 크기가 같은 파티션에 적재하는 방식이다. 
메모리가 할당되고 생성되는 과정에서 **외부 단편화**가 발생한다.

<img width="816" alt="image" src="https://github.com/java-two-people-get-in/Dododok-CS-study/assets/77064618/dfe69eae-eaa3-4123-9b92-b1324d537036">

### 1.2. 가변 분할 방식의 메모리 관리

외부 단편화 문제를 최소화 하기 위한 메모리 배치 방식

- first-fit : 최초 배치
    
    메모리 제일 앞부분부터 배치함
    
- best-fit : 최적 배치
    
    메모리 배치가 가능한 크기 중에서, 가장 작은 부분에 배치하여 **남는 공간을 최소화 한다.**
    
- worst-fit : 최악 배치
    
    메모리 배치가 가능한 크기 중에서, 가장 작은 부분에 배치하여 **남는 공간을 최대화 한다.**
    

→ 주기적 조각모음!

### 1.3. 고정 분할 방식의 메모리 관리

조각모음을 할 필요가 없다. **현대의 메모리 관리 시스템은 이 방식을 차용.**

### 1.4. 버디 시스템

가변 분할 방식에 고정 분할 방식 한 스푼 섞은 방식.

1. 프로세스 크기에 맞게, 메모리를 계속 절반으로 잘라 적절하게 배치한다.
2. 프로세스가 종료되면 주변에 같은 크기의메모리를 합친다.

## 2. 가상메모리 전략

실제 메모리의 용량은 한정적이고, 비싸다. 

시분할 시스템의 장점을 살리기 위해서, 최대한 많은 프로세스를 메모리에서 동작해야 한다. 

이때 프로세스 전체가 메모리에 올라가지 않더라도 실행 가능하게 하기 위해서 고안된 방법이다.

### 2.1. 가상 주소 (Virtual Address)

> 논리 주소는 물리 메모리의 주소 공간에 비례하지만,
가상 주소는 물리 메모리 공간이 아닌 가상의 주소 공간을 가진다.(조금다름)
> 

**가상 메모리 vs 가상 주소 공간**

→ 가상 메모리는 기법이며, 가상 주소 공간은 특정 프로세스가 할당받은 가상의 공간이다.

## 3. 페이징 기법

고정 분할 방식을 사용한 가상 메모리 관리 기법. **물리 주소 공간을 같은 크기로 나눈다.**
<img width="664" alt="image" src="https://github.com/java-two-people-get-in/Dododok-CS-study/assets/77064618/5ffe701d-52ae-4ac5-b277-a553f23b4ea6">


## 4. 세그멘테이션 기법

가변 분할 방식을 이용한 가상 메모리 관리 기법. **물리 메모리 공간을 프로세스 크기에 따라 가변적으로 나눈다.**

이대, 매핑된 정보가 담긴 테이블을 세그멘테이션 매핑 테이블이라고 한다.

**이 테이블은 메모리의 OS영역, PCB에 담겨 있다.**

<img width="879" alt="image" src="https://github.com/java-two-people-get-in/Dododok-CS-study/assets/77064618/a134ef6f-57bf-455f-80ee-8b92bbc7b07f">


## 5. 세그-페이징 혼용 기법

가상 메모리를 페이징 기법으로 나타내고, 커지는 페이지테이블을 세그멘테이팅 하는 기법.

→ 사용자 입장에서는 세그멘테이션, 메모리 입장에서는 페이징

<img width="686" alt="image" src="https://github.com/java-two-people-get-in/Dododok-CS-study/assets/77064618/0f9d391e-46d6-4d02-b33e-eddb4629963b">
