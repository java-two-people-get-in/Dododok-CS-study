## 인터럽트란?
- CPU가 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치에 예외상황이 발생하여 처리가 필요할 경우에 CPU에게 알려 처리할 수 있도록 하는 것
- 우선적으로 처리해야할 일이 발생하였을 때 그것을 처리하고 원래 동작으로 돌아옴
- 크게 하드웨어 인터럽트와 소프트웨어 인터럽트로 나눔

>그래서 인터럽트, **왜 하는걸까?**
그 이유는 **입출력 연산이 CPU 명령 수행속도보다 현저히 느리기 때문**이다.
>운영체제를 악덕 사장님, CPU를 비싼 월급 주고 데려온 고오급 인력이라고 생각해보자. 악덕 사장 입장에서는 비싼돈 들여온 만큼 고오급 인력이 쉬지않고 일해서 돈값을 했으면 좋겠다고 생각할 것이다.

<br/>

## 인터럽트 순서
#### 3.1. 인터럽트 처리 과정
```
요청 → 중단 → 보관 → 처리 → 재개
```

#### 처리 과정

> 1. 인터럽트 요청
> 2. 프로그램 실행 중단
> 현재 실행중이던 Micro Operation 까지 수행
> 3. 현재 실행중인 프로그램 상태 보관
> Interrupt Vector 를 읽어 ISR 주소값을 얻음
> ISR 로 점프 (이 때, PC 값은 자동 대피 저장됨)
> 현재 진행중인 프로그램의 레지스터를 대피함
> 4. 인터럽트 서비스 루틴 처리
> 인터럽트 원인을 파악하고 실질적인 작업 수행
> 서비스 루틴 수행 중, 우선순위가 더 높은 인터럽트가 발생하면 재귀적으로 1~5 과정 수행
> 5. 상태 복구
> 해당 작업을 다 처리하면, 대피시킨 레지스터를 복원한다
> ISR 끝에 RETI 명령어에 의해 인터럽트 해제
> 명령어가 실행되면, PC 값을 복원하여 이전 실행 위치로 복원

![](https://velog.velcdn.com/images/ozziny/post/e4a619cb-d566-46f7-a52c-b813c1ae397f/image.png)


### 하드웨어 인터럽트 (외부 인터럽트)
하드웨어가 발생시키는 인터럽트로(정확히는 하드웨어 컨트롤러), CPU가 아닌 다른 하드웨어 장치가 cpu에 어떤 사실을 알려주거나 cpu 서비스를 요청해야 할 경우 발생시킨다.

**종류**

- 입출력 인터럽트 (I/O interrupt) - 입출력 작업의 종료나 입출력 오류에 의해 CPU의 기능이 요청됨
![](https://velog.velcdn.com/images/ozziny/post/5077b612-64d1-46e8-8a26-25cbcc75ae36/image.png)

- 정전,전원 이상 인터럽트(Power fail interrupt) - 전원 공급의 이상
- 기계 착오 인터럽트(Machine check interrupt) - CPU의 기능적인 오류
- 외부 신호 인터럽트(External interrupt) - I/O 장치가 아닌 오퍼레이터나 타이머에 의해 의도적으로 프로그램이 중단된 경우


<br/>

### 소프트웨어 인터럽트 (내부 인터럽트)
소프트웨어가 발생시키는 인터럽트이다. 소프트웨어(사용자 프로그램)가 스스로 인터럽트 라인을 세팅한다.
trap 또는 exception 이라고도 함.

**종류**

- 프로그램 검사 인터럽트 (Program check interrupt) 
    - 0으로 나누는 경우
    - OverFlow/UnderFlow
    - 페이지 부재(Page fault)
    - 부당한 기억장소의 참조 등등..
- SVC(Supervisor Call: 감시프로그램 호출)인터럽트
    - 사용자가 프로그램을 실행시키거나 supervisior을 호출하는 동작을 수행하는 경우
    - 프로그래머에 의해 코드로 짜인 감시 프로그램을 호출하는 방식

인터럽트를 발생시키기 위해 하드웨어/소프트웨어는 cpu내에 있는 인터럽트 라인을 세팅하여 인터럽트를 발생시킨다.
cpu는 매번 명령을 수행하기 전에 인터럽트라인이 세팅되어있는지를 검사한다.

### 인터럽트 서비스 루틴(ISR : Interrupt Service Routine)


#### 인터럽트 핸들러
실제 인터럽트를 처리하기 위한 루틴으로 인터럽트 서비스 루틴이라고도 한다.
운영체제의 코드 영역에는 인터럽트별로 처리해야할 내용이 이미 프로그램되어 있다.

#### 인터럽트 벡터
인터럽드 발생시 처리해야 할 인터럽트 핸들러의 주소를 인터럽트 별로 보관하고 있는 테이블이다.

#### PCB(Process Control Block)
커널의 데이터 영역에 존재하며 각각의 프로세스마다 고유의 PCB가 있다.
인터럽트 발생 시 프로세스의 어느 부분이 수행중이었는지를 저장한다.
(수행중이던 memory 주소, 레지스터값, 하드웨어 상태 ...)
