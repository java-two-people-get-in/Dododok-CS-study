# [OS] CPU 스케줄링

## 0. 사전 지식
1. CPU 스케줄러 : 프로세스가 생성된 후 종료될 때까지 모든 상태 변화를 조정하는 일을 함
2. CPU 스케줄링 : 여러 프로세스의 상황을 고려해 CPU와 시스템 자원을 어떻게 배정할지 결정하는 것

## 1. 스케줄링 단계를 설명해주세요.
![CPU 스케줄링의 단계](https://github.com/java-two-people-get-in/Dododok-CS-study/assets/102593109/8cf189f6-73bd-4dbc-93f1-25acc72e981f)
<br>
[1단계] 고수준 스케줄링
- 시스템의 상황을 고려해 프로세스를 활성화할지 말지를 결정하기 때문에 동시에 실행 가능한 프로세스의 총 개수가 정해짐
- 시스템 내의 전체 작업 수를 조절하는 역할
  
[2단계] 중간 수준 스케줄링
- 프로세스를 보류 상태로 만들거나, 활성화 상태로 만들어 전체 시스템의 활성화된 프로세스 수를 조절함
- 전체 시스템의 과부하를 막는 역할

[3단계] 저수준 스케줄링
- 어떤 프로세스에 CPU를 할당할지, 어떤 프로세스를 대기 상태로 보낼지 등을 결정하는 단계
- 필요에 따라 준비 상태에 있는 프로세스를 실행 상태로 옮기기도 하고, 대기 상태로 보내기도 하며, 타임 아웃으로 준비 상태로 돌려보내기도 함
- 프로세스의 상태에 관한 내용은 대부분 저수준 스케줄링이 담당
<br>

### 1-1. 스케줄링의 목적을 설명해주세요.
1. 공평성 : 모든 프로세스가 자원을 공평하게 배정받아야 한다. 자원 배정 과정에서 배제되어서는 안 된다.
2. 효율성 : 시스템은 "유휴 시간(idle)"이 없도록 사용되어야 한다. 유휴 자원을 필요로 하는 프로세스에 "우선권"을 주어야 한다.
3. 안정성 : 시스템을 강제로 점유하거나, 파괴하려는 프로세스로부터 자원을 보호해야 한다.
4. 반응 시간 보장 : 적절한 시간 안에 프로세스의 요구에 반응해야 한다.
5. 무한 연기 방지 : 특정 프로세스의 작업이 무한하게 연기되어서는 안 된다.
   
<br>

## 2. 스케줄링 시 고려 사항을 설명해주세요.
- CPU 스케줄러가 어떤 프로세스에 우선적으로 CPU를 할당할지 결정할 때 고려해야 할 사항이다. 
<br>

2-1. 선점형 스케줄링 vs 비선점형 스케줄링
  
|구분|선점형|비선점형|
|------|---|---|
|작업 방식|어떤 프로세스가 CPU를 할당받아 실행 중이더라도 운체가 작업을 중단시키고 새로운 작업을 실행할 수 있다. |어떤 프로세스가 CPU를 점유하면 다른 프로세스가 이를 빼앗을 수 없다.|
|장점|프로세스가 CPU를 독점할 수 없어 빠른 응답 시간을 요구하는 대화형이나 시분할 시스템에 적합 |CPU 스케줄러의 작업량이 적고 문백 교환의 오베헤드가 적다|
|단점|컨텍스트 스위칭 등으로 오베헤드가 많음 |기다리는 프로세스가 많아 시스템 전체적인 처리율이 떨어짐|
|사용|시분할 방식에 많이 사용. 저수준 스케줄러에서 많이 사용|일괄 작업 방식 스케줄러에 사용|

<br>

2-2. 프로세스 우선순위
- 프로세스는 크게 커널 프로세스와 일반 프로세스로 나뉨
- 일반적으로 커널 프로세스의 우선순위가 일반 프로세스보다 높고 우선순위가 높다는 것은 더 빨리 더 자주 실행된다는 의미
- 같은 커널 프로세스와 일반 프로세스 끼리도 우선순위가 다르다. 예를 들어 일반 프로세서인 워드프로세서와 비디오 플레이어 2개가 있다고 할 때, 비디오 플레이어의 우선순위가 더 높다. 워드프로세서의 경우 사람이 사람이 타이핑하는 속도가 CPU 연산 순위보다 느리기 때문에 천천히 실행되어도 입력 처리가 가능하다. 하지만 비디오 플레이어는 실시간으로 데이터를 읽어와 영상과 소리를 출력해야 하므로 자주 실행되지 않으면 화면이 끊긴다.
<br>

2-3. CPU 집중 프로세스와 입출력 집중 프로세스

|CPU 집중 프로세스|입출력 집중 프로세스|
|------|---|
|수학 연산과 같이 CPU를 많이 사용하는 프로세스를 말한다. 즉 CPU 버스트(=CPU를 할당받아 실행하는 작업)가 많은 프로세스|저장장치에서 데이터를 복사하는 일과 같이 입출력을 많이 사용하는 프로세스를 말한다. 즉 입출력 버스트(=입출력 작업)가 많은 프로세스|

입출력 집중 프로세스는 잠깐 CPU를 사용한 후 대기 상태로 이동하기 때문에 다른 프로세스가 CPU를 사용할 수 있다. 따라서 CPU 집중 프로세스와 입출력 집중 프로세스가 같이 있을 때는 입출력 집중 프로세스를 먼저 실행 상태로 옮기는 것이 효율적이다.

<br>

2-4. 전면 프로세스와 후면 프로세스
|전면 프로세스|후면 프로세스|
|------|---|
|GUI를 사용하는 운영체제에서 화면의 맨 앞에 놓인 프로세스를 말한다. 현재 입출력을 사용하는 프로세스이므로 사용자와 상호작용이 가능|사용자와 상호작용이 없는 프로세스이다. 사용자의 입력 없이 작동하기 때문에 일괄 작업 프로세스라고도 함 ex.압축파일|

전면 프로세스는 사용자의 요구에 즉각 반응해야 하기 때문에 후면 프로세스보다 우선순위가 높다. 그만큼 후면 프로세스는 CPU를 할당받을 확률이 적다.

<br>
정리

|우선순위 높음|우선순위 낮음|
|------|---|
|커널 프로세스|일반 프로세스|
|전면 프로세스|후면 프로세스|
|대화형 프로세스|일괄 처리 프로세스|
|입출력 집중 프로세스|CPU 집중 프로세스|

<br>

## 4. 스케줄링 알고리즘

### 4-1. 스케줄링 알고리즘의 선택 기준을 설명해주세요.
- CPU 사용률 : 전체 시간 중 CPU가 작업을 처리하는 시간의 비율, 유휴 시간이 적을수록 CPU 사용률이 높다.
- 처리량 : CPU가 단위 시간당 작업을 마친 프로세스의 수, CPU가 얼마나 많은 일을 했는가, 높을수록 좋음
- 응답시간 : 요청 후 첫번째 응답이 오기까지 걸리는 시간, 짧을수록 좋음
- 대기시간 : 프로세스가 준비(ready) 큐에서 대기하는 시간들의 총합, 짧을수록 좋음
- 반환시간(=대기시간 + 실행시간) : 프로세스의 시작부터 끝알 때까지 걸리는 시간, 짧을수록 좋음

보통 처리량은 계산하기 어렵기 때문에 대기 시간, 응답 시간 , 반환 시간을 계산한다.



### 4-2. 스케줄링 알고리즘에 대해 설명해 주세요.
|구분|종류|
|------|---|
|비선점형|FCFS , SJF , HRN|
|선점형|라운드 로빈, SRT, 다단계 큐, 다단계 피드백 큐|
|둘 다 가능|우선순위 스케줄링|

### a. FCFS(First Come First SErved) == FIFO == 선입선출 스케줄링
![FCFS 스케줄링의 동작](https://github.com/java-two-people-get-in/Dododok-CS-study/assets/102593109/d4c92e72-5a2b-46f8-9e56-4bd4178d40f6)
- 준비 큐에 도착한 순서대로 CPU를 할당하는 비선점형 방식
- 큐가 하나이므로 모든 프로세스의 우선순위가 동일하다.
- 콘보이 효과(=호위 효과) : FCFS 알고리즘은 단순하고 공평하지만, 처리 시간이 긴 프로세스가 CPU를 차지하면 다른 프로세스는 계속 기다려 시스템의 효율성이 떨어지는 문제

### b. SJF(Shortes Job First) == SPF == 최단 프로세스 우선 스케줄링
![SJF 스케줄링의 동작](https://github.com/java-two-people-get-in/Dododok-CS-study/assets/102593109/302999f4-98ee-4103-832f-ac9eb429f493)
- 준비 큐에 있는 프로세스 중에서 실행 시간이 가장 짧은 작업부터 CPU를 할당하는 비선점형 방식
- 시간이 오래 걸리는 작업이 앞에 있고 간단한 작업이 뒤에 있으면 순서를 바꾸어 CPU를 배정
- 운영체제가 프로세스의 종료 시간을 정확하게 예측하기 어렵고, 아사현상이 발생할 수 있다는 단점 존재
- 아사 현상 : 특정 프로세스의 우선순위가 낮아 작업이 계속해서 연기되는 상태
- 에이징 : 아사 현상을 완화하기 위한 방법. 프로세스가 양보할 수 있는 상한선을 정하는 방식으로 프로세스가 자신의 순서을 양보할 때마다 우선순의를 높여 양보할 수 있는 상한선을 정함

### c. HRN(Highest Response Ratio Next) == 최고 응답률 우선 스케줄링
![HRN스케줄링에서 우선순의 결정하는 기준](https://github.com/java-two-people-get-in/Dododok-CS-study/assets/102593109/81ee60e3-b4a5-43c8-9f1d-356bb7f0c42e)
- SJF 스케줄링에서 발생할 수 있는 아사 현상을 해결하기 위해 만들어진 비선점형 알고리즘
- SJF 스케줄링은 프로세스의 실행 시간이 판단 기준이므로 항상 적은 시간을 사용하는 프로세스에게 우선권이 주어지지만, HRN 스케줄링은 서비스를 받기 위해 기다린 시간과 CPU 사용 시간을 고려해 스케줄링을 함
- HRN 스케줄링에서 프로세스의 우선순의를 결정하는 기준

### d. 라운드 로빈(Round Robin, RR)
![라운드로빈 스케줄링의 동작](https://github.com/java-two-people-get-in/Dododok-CS-study/assets/102593109/65df2194-b187-4b2d-97ef-188dc6d5999d)
- 한 프로세스가 할당받은 시간(타임 슬라이스) 동안 작업을 하다가 작업을 완료하지 못하면 준비 큐의 맨 뒤로 가서 자기 차례를 기다리는 방식
- 프로세스들이 작업을 완료할 때까지 순환하면서 실행되며, 우선 순위를 적용하지 않은 알고리즘
- FCFS 방식 차이점 : 각 프로세스마다 CPU를 사용할 수 있는 시간 제한이 있다는 것
  
